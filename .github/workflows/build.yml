name: Build and Release Domain Extractor

on:
  push:
    tags:
      - 'v*'  # –ó–∞–ø—É—Å–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–≥–∞ –≤–µ—Ä—Å–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, v1.0.0)
  workflow_dispatch:  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  build-windows-portable:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
        
    - name: Build portable version (onedir)
      run: |
        pyinstaller --onedir --windowed --name="DomainExtractor" --icon=icon.ico domain_extractor.py
      continue-on-error: true
      
    - name: Build portable version (without icon)
      if: failure()
      run: |
        pyinstaller --onedir --windowed --name="DomainExtractor" domain_extractor.py
        
    - name: Create portable package
      run: |
        mkdir portable
        xcopy /E /I dist\DomainExtractor portable\DomainExtractor
        echo "# Domain Extractor - Portable Version" > portable\README.txt
        echo "" >> portable\README.txt
        echo "–ü—Ä–æ–≥—Ä–∞–º–º–∞ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–º–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω –∏–∑ —Ñ–∞–π–ª–æ–≤." >> portable\README.txt
        echo "" >> portable\README.txt
        echo "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:" >> portable\README.txt
        echo "1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ DomainExtractor\DomainExtractor.exe" >> portable\README.txt
        echo "2. –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª —Å –¥–æ–º–µ–Ω–∞–º–∏" >> portable\README.txt
        echo "3. –í—ã–±–µ—Ä–∏—Ç–µ –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤" >> portable\README.txt
        echo "4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏" >> portable\README.txt
        echo "5. –ù–∞–∂–º–∏—Ç–µ '–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–∞–π–ª'" >> portable\README.txt
        echo "" >> portable\README.txt
        echo "–í—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ –ø–∞–ø–∫—É DomainExtractor." >> portable\README.txt
        echo "–ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å —Ñ–ª–µ—à–∫–∏ –∏–ª–∏ –ª—é–±–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ –Ω–æ—Å–∏—Ç–µ–ª—è." >> portable\README.txt
        
    - name: Create ZIP archive
      run: |
        powershell Compress-Archive -Path portable\* -DestinationPath DomainExtractor-Windows-Portable.zip
        
    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: DomainExtractor-Windows-Portable
        path: DomainExtractor-Windows-Portable.zip
        
    - name: Get version from tag
      id: get_version
      shell: bash
      run: |
        if [[ $GITHUB_REF == refs/tags/* ]]; then
          echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
        else
          echo "VERSION=dev-$(date +'%Y%m%d-%H%M%S')" >> $GITHUB_OUTPUT
        fi
        
    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: |
          DomainExtractor-Windows-Portable.zip
        body: |
          ## Domain Extractor ${{ steps.get_version.outputs.VERSION }}
          
          ### üì• –°–∫–∞—á–∞—Ç—å
          - **Windows Portable (x64)**: DomainExtractor-Windows-Portable.zip
          
          ### ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
          - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–æ–º–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω –∏–∑ —Ñ–∞–π–ª–æ–≤ —Å –ª—é–±—ã–º —Ç–µ–∫—Å—Ç–æ–º
          - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤—ã–≤–æ–¥–∞ (–ø–æ–ª–Ω—ã–π –¥–æ–º–µ–Ω, –±–µ–∑ TLD, —Ç–æ–ª—å–∫–æ TLD)
          - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –∏ —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤ –¥–ª—è –≥–∏–±–∫–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
          - –†–∞–∑–ª–∏—á–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ (—Å—Ç—Ä–æ–∫–∞, –ø—Ä–æ–±–µ–ª, –∑–∞–ø—è—Ç–∞—è, —Ç–∞–±—É–ª—è—Ü–∏—è)
          - –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
          - –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–≤—ã—Ö 100 –∑–∞–ø–∏—Å–µ–π
          - –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
          - –£–¥–∞–ª–µ–Ω–∏–µ www. –∏–∑ –¥–æ–º–µ–Ω–æ–≤
          
          ### üíª –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
          - Windows 10/11 (64-bit)
          - –ù–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Python
          - –ü–æ—Ä—Ç–∞—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è - –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å —Ñ–ª–µ—à–∫–∏
          
          ### üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞
          1. –°–∫–∞—á–∞–π—Ç–µ –∞—Ä—Ö–∏–≤ **DomainExtractor-Windows-Portable.zip**
          2. –†–∞—Å–ø–∞–∫—É–π—Ç–µ –≤ –ª—é–±—É—é –ø–∞–ø–∫—É (–∏–ª–∏ –Ω–∞ —Ñ–ª–µ—à–∫—É)
          3. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É **DomainExtractor**
          4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ **DomainExtractor.exe**
          
          ### üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
          1. –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª —Å —Ç–µ–∫—Å—Ç–æ–º, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º –¥–æ–º–µ–Ω—ã
          2. –í—ã–±–µ—Ä–∏—Ç–µ –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
          3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏:
             - **–§–æ—Ä–º–∞—Ç –¥–æ–º–µ–Ω–∞**: –ø–æ–ª–Ω—ã–π (domain.com), –±–µ–∑ TLD (domain), —Ç–æ–ª—å–∫–æ TLD (.com)
             - **–ü—Ä–µ—Ñ–∏–∫—Å**: —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥ –¥–æ–º–µ–Ω–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, https://)
             - **–°—É—Ñ—Ñ–∏–∫—Å**: —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –¥–æ–º–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, /api)
             - **–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å**: –∫–∞–∫ —Ä–∞–∑–¥–µ–ª—è—Ç—å –¥–æ–º–µ–Ω—ã –≤ –≤—ã—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
             - **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏**: —É–¥–∞–ª–∏—Ç—å www, –¥—É–±–ª–∏–∫–∞—Ç—ã, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
          4. –ù–∞–∂–º–∏—Ç–µ "–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–∞–π–ª" –∏–ª–∏ "–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä (100 –∑–∞–ø–∏—Å–µ–π)"
          
          ### üìù –ü—Ä–∏–º–µ—Ä
          **–í—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª:**
          ```
          –ü–æ—Å–µ—Ç–∏—Ç–µ example.com –∏ www.test.org –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
          Email: admin@site.net
          ```
          
          **–†–µ–∑—É–ª—å—Ç–∞—Ç (–ø–æ–ª–Ω—ã–π –¥–æ–º–µ–Ω, –±–µ–∑ www):**
          ```
          example.com
          test.org
          site.net
          ```
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
